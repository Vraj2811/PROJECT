<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Modal Test</h1>
        <button id="testBtn" class="btn btn-primary">Test Modal</button>
        <button id="hideBtn" class="btn btn-secondary">Force Hide Modal</button>
        
        <div id="log" class="mt-3">
            <h5>Log:</h5>
            <div id="logContent" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>
        </div>
    </div>

    <!-- Test Modal -->
    <div class="modal fade" id="testModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title">Test Modal</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Testing modal functionality...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testModal = null;
        const logContent = document.getElementById('logContent');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContent.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        function hideTestModal() {
            if (testModal) {
                try {
                    testModal.hide();
                    log('Modal hidden successfully');
                } catch (error) {
                    log('Error hiding modal: ' + error.message);
                    // Force hide
                    try {
                        const modalElement = document.getElementById('testModal');
                        if (modalElement) {
                            modalElement.style.display = 'none';
                            modalElement.classList.remove('show');
                            document.body.classList.remove('modal-open');
                            const backdrop = document.querySelector('.modal-backdrop');
                            if (backdrop) {
                                backdrop.remove();
                            }
                            log('Modal force hidden');
                        }
                    } catch (forceError) {
                        log('Error force hiding modal: ' + forceError.message);
                    }
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM loaded');
            
            try {
                const modalElement = document.getElementById('testModal');
                if (modalElement) {
                    testModal = new bootstrap.Modal(modalElement, {
                        backdrop: 'static',
                        keyboard: false
                    });
                    log('Modal initialized successfully');
                } else {
                    log('Modal element not found');
                }
            } catch (error) {
                log('Error initializing modal: ' + error.message);
            }
            
            document.getElementById('testBtn').addEventListener('click', function() {
                log('Test button clicked');
                
                if (testModal) {
                    try {
                        testModal.show();
                        log('Modal shown successfully');
                        
                        // Auto hide after 3 seconds
                        setTimeout(() => {
                            hideTestModal();
                        }, 3000);
                        
                    } catch (error) {
                        log('Error showing modal: ' + error.message);
                    }
                } else {
                    log('Modal not available');
                }
            });
            
            document.getElementById('hideBtn').addEventListener('click', function() {
                log('Hide button clicked');
                hideTestModal();
            });
        });
    </script>
</body>
</html>
